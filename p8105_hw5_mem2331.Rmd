---
title: "Homework 5"
author: "Molly Martorella"
date: "11/2/2019"
output: html_document
---

```{r setup, include=FALSE}

library(tidyverse)


knitr::opts_chunk$set(
  echo = TRUE,
  fig.width = 8,
  fig.height = 6,
  out.width = "90%")

options(knitr.kable.NA = "")

theme_set(theme_bw())

```


# Problem 1

```{r}

set.seed(10)

iris_with_missing = iris %>% 
  map_df(~replace(.x, sample(1:150, 20), NA)) %>%
  mutate(Species = as.character(Species))

```

The following function, 'fix_iris':
1. fills in missing values with the mean of non-missing values for numeric columns.
2. fills in missing values with "virginica" for character columns.

```{r}

fix_iris <- function(column_to_fix){
  
  if (is.numeric(column_to_fix)) {
    
    col_mean = mean(column_to_fix, na.rm = TRUE)
    new_num_column = replace_na(column_to_fix, col_mean)
    
  } else if (is.character(column_to_fix)) {
    
    new_char_column = replace_na(column_to_fix, "virginica")
    
  } else if (!is.numeric(column_to_fix) | !is.character(column_to_fix)) {
    stop("Column vector must be numeric or character class.")
  }
  
}

```

Using a map statement to apply this function to the iris dataframe:

```{r}

map(iris_with_missing, fix_iris)

```

# Problem 2

Reading in an tidying data from a directory using map function and stringr.

```{r}

files <- tibble(
  file_name = list.files(path = "data/data_2", full.names = TRUE))

study <- 
  files %>% 
  mutate(
    file_data = map(file_name, read_csv)
  ) %>% 
  unnest(cols = file_data) %>% 
  pivot_longer(
    week_1:week_8,
    names_to = "week",
    values_to = "observation"
  ) %>% 
  separate(file_name, 
           into = c("data", "folder", "subject_id"), 
           sep = "\\/", 
           remove = TRUE) %>% 
  mutate(
    study_arm = str_extract(subject_id, pattern = "[ce][ox][np]"),
    study_arm = as.factor(study_arm),
    subject_id = str_remove(subject_id, pattern = "\\.csv"),
    week = str_remove(week, pattern = "week_"),
    week = as.numeric(week)
  ) %>% 
  select(subject_id, study_arm, week, observation)

```

Plotting participant observations over time:

```{r}

study %>% 
  ggplot(aes(x = week, y = observation, color = study_arm, group = subject_id)) +
  geom_line() +
  ggtitle("Longitudinal study observations")

```

The control group has relatively constant observation values whereas the experimental group shows an increasing trend in observation values over time.

# Problem 3


